[[_TOC_]]
This Readme is autogenerated by cookicutter template. You are responsible on making corrections and improvements if needed. This is
just for you to start using the project easily.

#### 1. Requirements
To setup and run the project only docker and docker-compose is required. These are tested versions!
  - docker 19.03.13
  - docker-compose 1.27.4

#### 2. Setup Project
With docker-compose you can setup whole project very easy. The only thing may needs to be modified is .env.prod or 
.env.dev  files for production and development use respectively. Updating environmental variables is not necessary, 
but it is preferable for production usage!
##### 2.1 For Development
For development django development web server is enough, so no Nginx or Gunicorn are used. docker-compose.yml file will
be used for development environment.
1. modifying .env.dev file if preferred, but It will work without modifications
2. To build, run:  
`docker-compose build`
3. To Start, run:  
`docker-compose up -d` in detached mode or `docekr-compose up` in interactive mode.
4. To stop(if started with -d option), run:  
`docker-compose down`
5. to stop and remove all volumes(**This means that database will be deleted as well**), run:  
`docker-compose down -v --remove-orphans`

##### 2.2 For Production
In production, application will run behind Gunicorn and Nginx. docker-compose.prod.yml file is
used for production environment. Before running, ensure that Postgres DB is running somewhere. As an example you can use
docker-compose.postgresql_example.yml file for docker-compose config which runs pg and pgadmin containers. 
1. modify .env.prod file. It is mandatory to specify DB settings. It will not work without setting them. If 
docker-compose.postgresql_example.yml was used for setting up database, please have a look at this file to get db settings and
fill them here.
2. To build, run:
`docker-compose -f docker-compose.prod.yml build`
3. To Start, run:  
`docker-compose -f docker-compose.prod.yml up -d` in detached mode or `docekr-compose -f docker-compose.prod.yml up` 
in interactive mode.
4. To stop(if started with -d option), run:  
`docker-compose -f docker-compose.prod.yml down`
5. to stop and remove all volumes(**This means that database will be deleted as well**), run:  
`docker-compose -f docker-compose.prod.yml down -v --remove-orphans`
##### 2.3 ENV Vars
- PostgreSQL  
This variables is used when PostgreSQL container is created. Database `POSTGRES_DB` with user `POSTGRES_USER` and 
password `POSTGRES_PASSWORD` is created and will be accessible for other services on `POSTGRES_SERVER:POSTGRES_PORT`.
These variables is used by django application service as well for connecting to database.
The values of this variables should be modified for production environment in .env.prod file.
  - POSTGRES_SERVER=db  
  Hostname of PostgreSQL service. When using docker-compose services can use service names as network addresses. In this
  case "db" is name of PostgreSQL service in docker-compose.yml file. This variable is used in Django app as well.
  - POSTGRES_USER=dev  
  User for PostgreSQL
  - POSTGRES_PASSWORD=dev  
  Password for PostgreSQL user
  - POSTGRES_DB=internal_software  
  Name of the database, which will be created automatically when docker container is created for "db" service. If external
  database is used, this should be name of the already created database,so Django can use it.
  - POSTGRES_PORT=5432   
  PostgreSQL server port.

- PGAdmin
PGAdmin is client for PostgreSQL server. This service is also started automatically. These variables are used on
container creation, and could be used to login into PGAdmin web interface.
  - PGADMIN_LISTEN_PORT=5050  
  HTTP Port for PGAdmin web application
  - PGADMIN_DEFAULT_EMAIL=dev@admin.com  
  Username for PGAdmin web application. This will be used for login.
  - PGADMIN_DEFAULT_PASSWORD=dev  
  Password for PGAdmin web application. This will be used for login.

- Django
These variables are used by Django application.
  - DJANGO_SUPERUSER_USERNAME=admin  
  Default superuser username, which is created automatically on system startup. When already exists, you may see
  error message in docker-compose logs which says that this username is already used. It's OK, just ignore it.
  - DJANGO_SUPERUSER_PASSWORD=adminadmin  
  Password for first superuser
  - DJANGO_SUPERUSER_EMAIL=admin@admin.com  
  Email address for first supperuser. This filed is mandatory for Django commnad. No mails are sent at this moment by
  the application. Anyway it is preferred to set this variable to existing email.
  - DEBUG=0  
  Debug mode of the application. Debug mode is activated when it is set to 1. It exposed lot off information when error 
  is raised by the application, so debug mode should be avoided in production environment. Set it to 0 for production.
  - SECRET_KEY=2ew6dq5xo2tux7!k7zmc%x^#b17djd8-co=f9ygspx@e=!85mx  
  A secret key for a particular Django installation. This is used to provide cryptographic signing, 
  and should be set to a unique, unpredictable value.
  - DJANGO_ALLOWED_HOSTS=localhost 127.0.0.1 [::1]  
  Empty space separated list of strings representing the host/domain names that this Django site can serve. Simply, any 
  IP or domain which
  will be used to access the application should be included in this list.
  - DJANGO_SETTINGS_MODULE=backend.settings.prod  
  Settings module for django application. Rarely someone will need to change this value.
  - AUTH_API_PATH_FOR_USER='http://192.168.1.4:8000/api/auth/users/me/'
  Path to auth service for getting user info. It is very important to set this accurately.
  - AUTH_API_PATH_FOR_ROLE='http://192.168.1.4:8000/api/auth/roles/'
  Path to auth service for getting role info. It is very important to set this accurately.  

#### 3. Usage
##### 3.1. Urls and swagger interface
If everything is OK, application is already running on **port {{cookiecutter.django_port_for_dev}}** for development environment and **port 8181** for
 production, until you modified ports in docker-compose.yml and docker-compose.prod.yml files.
Here is some links you will need:
- http://localhost:{{cookiecutter.django_port_for_dev}}/api/{{cookiecutter.project_slug}}/admin/ - Django's integrated Admin panel
- http://localhost:{{cookiecutter.django_port_for_dev}}/api/{{cookiecutter.project_slug}}/schema/ - OpenAPI3 schema definition file
- http://localhost:{{cookiecutter.django_port_for_dev}}/api/{{cookiecutter.project_slug}}/schema/swagger-ui/ - Interactive swagger user interface to test API

In swagger-ui there is authorization button on top-right corner, where you have to paste JWT token to get access on 
application. To get token, go to AuthAPI service.


##### 3.2. CI/CD
This project comes with minimal .gitlab-ci.yml configuration. Ther are several stages but only linter is doing actual work right now.
Other jobs like tests, build and deploy are just for demonstration that ci/cd pipeline is working and to give you some thoughts how to setup them.

You should enable Gitlab runner on this project at first, otherwise pipeline will not be run. For this go to current project page on gitlab and
 go to `settings -> CI/CD -> Runners` and you will need to enable(click "enable for this project" button) one of the runners for this project under **specific runners** section.

##### 4. Troubleshooting
If you are on Windows, there may be some issues on running the project, because of linux/windows newline differences. Scripts are written in linux
so they have "/n" at the end of each line, but windows expects "/r/n" for new line, so you may need to fix this scripts. You have several choice:
1. Move to normal OS :D
2. This tool https://waterlan.home.xs4all.nl/dos2unix.html may help you(Not Tested!)
3. You can just try to remove new line between each to lines and press "enter" to create new "new line". This is not vest way for big scripts  but these scripts are really small.  

Please give some feedback wchich way is working or not working so we can update readme. 


#### 5. Used packages
- [Django 3.1.4](https://www.djangoproject.com/)
- [Django REST Framework 3.12.2](https://www.django-rest-framework.org/)
- [djangorestframework-simplejwt 4.6.0](https://django-rest-framework-simplejwt.readthedocs.io/en/latest/)
- [drf-spectacular==0.11.1](https://drf-spectacular.readthedocs.io/en/latest/)
- [gunicorn==20.0.4](https://gunicorn.org/)